<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' " #scrollToTop [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow ">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <!-- <li><a> Fleets</a></li> -->
    <li><a routerLink="/iol/fleets/flt/poi">P.O.I</a></li>
  </ol>
</div>

<div [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "   style="padding-bottom:200px" [hidden]="!isAuthorized">
  <div class="panel-heading font-weight-600 margin-bottom-0">
  </div>
  <div class="row">
    <div class="panel-body padding-0">
      <div class="tab-content">
        <div class="tab-pane active" id="Summary">
          <div class="col-lg-4">
            <div class="panel panel-default round margin-bottom-0 card shadow light">
              <div class="panel-heading margin-bottom-0">
                <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">Choose Parameters</h3>
                <div class="panel-actions">
                  <a></a>
                </div>
              </div>
              <div class="panel-body padding-15 ">
                <div class="panel">
                  <div class="col-lg-10" *ngIf="loggedInUser.read_only != true"
                    style="padding:0px; margin-top: 10px; margin-bottom: 15px; margin-left: 20px;">
                    <button #editpop type="button" class="btn btn-lg btn-primary btn-block btncolor" (click)="addNew()"
                      data-target="#editpop1" data-toggle="modal" style="font-size: 14px;border-radius: 20px;">
                      <i class="ri-add-circle-fill"></i> New
                    </button>
                  </div>

                  <div class="col-lg-12" style="margin-top: 5px; margin-bottom: 5px;">
                    <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">
                      <div class="form-group margin-bottom-10">
                        <fieldset class="form-fieldset ">
                          <legend>Search</legend>

                          <div class="form-group margin-bottom-10">
                            <div class="input-search">
                              <i class="input-search-icon ri-search-line"></i>
                              <input type="text" class="form-control" formControlName="search" [(ngModel)]="inputValue"
                                name="search" placeholder="Search...">
                              <button type="button" class="input-search-close icon " data-toggle="popover"
                                data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                                data-html="true" id="help2" pTooltip='Search By Name' tooltipPosition="top"><i
                                  class="ri-question-line"></i></button>
                              <div id="popover-content-help2" class="hide">
                                Some help information goes here
                              </div>
                            </div>
                          </div>

                          <div class="form-group margin-bottom-0 text-center">
                            <button href="" type="submit" (click)='updateFilter(inputValue)'
                              class="btn btn-success btn-round btn-block1"> <i class=" ri-search-line "></i>
                              Search</button>
                            <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i
                                class="ri-refresh-line "></i>
                              Clear
                            </button>
                          </div>
                        </fieldset>
                      </div>
                      <hr>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-8">
            <div class="panel panel-default round margin-bottom-0 ">
              <div class="panel-heading margin-bottom-0">
                <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">Map</h3>
                <div class="panel-actions">
                  <a></a>
                </div>
              </div>
              <div class="panel-body padding-15">
                <div class="map-wrapper" style="position:relative">
                  <!-- <app-google-map #poiMap [height]="'350px'" style="width:100%"></app-google-map> -->
                  <div #gmapZone style="width:100%;" [ngStyle]="{'height':'390px'}"></div>
                  <!-- <app-spin-loading [appLoader]="mapLoader"></app-spin-loading> -->
                </div>
              </div>
            </div>

            <div class="row margin-top-20">
              <div class="col-lg-12">
                <div class="panel panel-default round margin-bottom-0">
                  <div class="panel-heading margin-bottom-0">
                    <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">List</h3>
                    <div class="panel-actions">
                      <a></a>
                    </div>
                  </div>

                  <div class="table-responsive margin-top-20 padding-15">
                    <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}" mode="indeterminate">
                    </p-progressBar>

                    <table style="border: 1px solid #ebebeb;" matSort (matSortChange)="sortTerritoryList($event)"
                      class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1" mat-table
                      [dataSource]="territories" mat-elevation-z8>
                      <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>NAME</th>
                        <td mat-cell *matCellDef="let row">
                          {{(row.name == null) ? 'N/A': row.name}}
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>STATUS
                        </th>
                        <td mat-cell *matCellDef="let row">
                          <span class="label"
                            [ngClass]="(row.status === EntityStatusEnum.Active)? 'label-success': 'label-danger'">{{(row.status
                            === EntityStatusEnum.Active)? 'Active' :
                            'Inactive'}}</span>
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="poi_type">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>POI Type</th>
                        <td mat-cell *matCellDef="let row">
                          {{(row.poi_type == null) ? 'N/A': row.poi_type_name}}
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>ACTIONS
                        </th>
                        <td mat-cell *matCellDef="let row">
                          <button *ngIf="loggedInUser.read_only != true" type="button"
                            class="btn btn-icon  btn-info btn-xs" data-target="#editpop1" data-toggle="modal"
                            pTooltip="Edit" (click)="openEditModal(row)">
                            <i class="icon ion-edit"></i>
                          </button>
                          <button *ngIf="loggedInUser.read_only != true" type="button" pTooltip="Delete "
                            class="btn btn-icon  btn-danger btn-xs" (click)="showSwal(row)"
                            data-original-title="Delete"> <i class="icon ion-android-delete"></i>
                          </button>
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="displayedPoiList"></tr>
                      <tr mat-row *matRowDef="let row; columns: displayedPoiList;">
                      </tr>
                    </table>

                    <div *ngIf="territories?.length === 0 && !submitted && !showIndeterminateProgress"
                      class="no-records">No records found</div>

                    <mat-paginator translate="no" #territoryPaginator [length]="totalTerritoryLength" [hidePageSize]="true"
                      showFirstLastButtons (page)="onTerritoryPagination($event)" [pageSize]="10">
                    </mat-paginator>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade  modal-success text-left" id="editpop1" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center  modal-lg">
    <div class="modal-content">
      <div class="modal-header" [ngStyle]="theme">
        <button type="button" class="close" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title">{{inactiveRecord? 'Update POI' : formTitle}}</h4>
      </div>
      <form novalidate [formGroup]="territoryForm" id="tryFormID" (ngSubmit)="onSubmit(territoryForm.value)">
        <div class="modal-body">
          <div class="">
            <div class="row">
              <div class="col-lg-12">
                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="control-label">Select Type<span class="text-danger2">*</span></label>
                      <p-dropdown [options]="zoneAccess" name="poi_type" formControlName="poi_type"
                        [(ngModel)]="selectedPOI" styleClass="prime-dropdown" placeholder="Select POI Type">
                      </p-dropdown>
                      <span class="error-message"
                        *ngIf="territoryForm.get('poi_type').getError('required') && submitted">
                        Please provide type
                      </span>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="control-label">Poi Name<span class="text-danger2">*</span></label>
                      <div class="input-icon">
                        <input type="text" class="form-control" formControlName="name" maxLength="25" />
                      </div>
                      <span class="error-message" *ngIf="territoryForm.get('name').getError('required') && submitted">
                        Please provide name
                      </span>
                    </div>
                  </div>
                  <input type="hidden" formControlName=id>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="control-label">Radius<span class="text-danger2">*</span></label>
                      <div class="input-group">
                        <input type="text" min="50" max="999"
                          oninput="this.value = !!this.value &&  this.value <= 999? this.value : null;"
                          class="form-control" formControlName="poi_radius" placeholder="Radius between 50-999">
                        <span class="input-group-addon">[m]</span>
                      </div>
                      <span class="error-message" style="position: relative !important"
                        *ngIf="territoryForm.get('poi_radius').getError('required')  && submitted">Please enter Radius
                        <br>
                      </span>
                      <span class="error-message" style="position: relative !important"
                        *ngIf="territoryForm.get('poi_radius').value < 50  && submitted">
                        <small>Radius must be between 50-999 km</small>
                      </span>
                    </div>
                  </div>

                  <div class="col-md-3" *ngIf="btnText === 'Update'">
                    <div class="form-group margin-top-35">
                      <label class="control-label"><input formControlName="status_id" type="checkbox" value=""><span
                          style="margin-left: 5px;">Status</span></label>
                    </div>
                  </div>


                  <div class="col-lg-12">
                    <div class="clearfix mapbox-right">
                      <app-google-map #binMap mapType="false" [markerLimit]="1" [height]="'350px'"
                        (click)="mapClicked($event)" [showSearchBar]="true"></app-google-map>

                      <fieldset [disabled]="inactiveRecord">
                        <button type="button" class="btn btn-warning btn-block" [disabled]="!source_latlong || selected_poi_type === 'Routes'"
                          (click)="resetMap()">Remove Marker
                        </button>
                        <span *ngIf="inactiveRecord || !source_latlong"><i
                            class="fa fa-info-circle margin-right-5"></i>Click on the map to drop marker.</span>
                      </fieldset>
                      <button *ngIf="territoryPath" type="button" class="btn btn-warning btn-block"
                        (click)="resetMap()">Remove Territory</button>
                    </div>
                  </div>

                </div>
              </div>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" #closeForm class="btn btn-default btn-round btn-block1"
            data-dismiss="modal">Close</button>
          <button type="submit" [disabled]="btnLoading" class="btn btn-success btn-round btn-block1"
            form="tryFormID">{{btnText}}</button>
        </div>
      </form>
    </div>
  </div>
</div>
