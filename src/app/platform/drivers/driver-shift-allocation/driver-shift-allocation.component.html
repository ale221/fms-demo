<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' "
  #scrollToTop [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow ">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <li><a routerLink="/iol/drivers/shiftallocation">Shift Allocations</a></li>
  </ol>
</div>

<div
  [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "
  style="padding-bottom:200px" [hidden]="!isAuthorized">
  <!--  Modal Form-->
  <div class="modal fade  modal-success text-left" data-backdrop="static"
    (hide)="false;$event.preventDefault();$event.stopPropagation();" id="editpop1" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-center" [ngClass]="'modal-lg'">
      <div class="modal-content">
        <div [ngStyle]="branding" class="modal-header">
          <button type="button" class="close" data-dismiss="modal" (click)="resetEverything()">
            <span>x</span>
          </button>
          <h4 class="modal-title">{{formTitle}} Allocation</h4>
        </div>
        <div class="modal-body padding-bottom-20">
          <div class="">
            <div class="row1">
              <form [formGroup]="templateForm" id="binFormID" (ngSubmit)="onSubmitTemplate(templateForm)">

                <div *ngIf="true" class="form-group1 row">
                  <div class="col-lg-12">
                    <div class="">

                      <div class="row">
                        <div class="col-lg-6">
                          <div class="form-group1 row1">
                            <div class="">
                              <div class="form-group">
                                <label class="control-label">Driver<span class="text-danger2">*</span></label>
                                <p-dropdown [(ngModel)]="selectedDriver" [options]="drivers_list"
                                  styleClass="prime-dropdown" filterPlaceholder="Search" formControlName="driver_id"
                                  placeholder="Select Driver">
                                </p-dropdown>
                              </div>
                              <span class="error-message" style="margin-top: -16px"
                                *ngIf="templateForm.get('driver_id').getError('required') && Submitted ">
                                Please Select Drivers
                              </span>
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group1 row1">
                            <div class="">
                              <div class="form-group">
                                <label class="control-label">Shift<span class="text-danger2">*</span></label>
                                <p-dropdown [options]="shifts_list" styleClass="prime-dropdown"
                                  filterPlaceholder="Search" formControlName="shift_id" placeholder="Select Shift">
                                </p-dropdown>
                              </div>
                              <span class="error-message" style="margin-top: -16px"
                                *ngIf="templateForm.get('shift_id').getError('required') && Submitted ">
                                Please Select Shifts
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-lg-6">
                          <div class="form-group1 row1">
                            <div class="">
                              <div class="form-group">
                                <label class="control-label">Start Date<span class="text-danger2">*</span></label>
                                <p-calendar [formControlName]="'start_date'" [monthNavigator]="true"
                                  [yearNavigator]="true" [minDate]="currentDate" showTime="true" hourFormat="24"
                                  [yearRange]="'1950:'+(currentDate.getFullYear())" placeholder="MM/DD/YYYY"
                                  styleClass="prime-datetime">
                                </p-calendar>

                              </div>
                              <span class="error-message" style="margin-top: -16px"
                                *ngIf="templateForm.get('start_date').getError('required') && Submitted">
                                Please provide Start Date
                              </span>
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-6">
                          <div class="form-group1 row1">
                            <div class="">
                              <div class="form-group">
                                <label class="control-label">End Date<span class="text-danger2">*</span></label>
                                <p-calendar [formControlName]="'end_date'" [monthNavigator]="true"
                                  [yearNavigator]="true" [minDate]="currentDate" showTime="true" hourFormat="24"
                                  [yearRange]="'1950:'+(currentDate.getFullYear())" placeholder="MM/DD/YYYY"
                                  styleClass="prime-datetime">
                                </p-calendar>

                              </div>
                              <span class="error-message" style="margin-top: -16px"
                                *ngIf="templateForm.get('end_date').getError('required') && Submitted ">
                                Please provide End Date
                              </span>
                            </div>
                          </div>
                        </div>

                      </div>

                    </div>
                  </div>
                </div>


              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default btn-round btn-block1" (click)="resetEverything()"
            data-dismiss="modal" #closeModalBtn>
            &nbsp;Close
          </button>
          <button type="button" class="btn btn-success btn-round btn-block1"
            (click)="onSubmitTemplate(templateForm.value)"
            [disabled]="submitFormLoader.visibility || completeEdit || btnLoading">
            {{btnText}}
          </button>
        </div>
      </div>
    </div>
  </div>
  <!--  Modal Form-->






  <!-- <h2 class="page-title">Jobs</h2>
  <hr class="margin-top-10" /> -->
  <div class="row">
    <div class="col-lg-4">
      <div class="panel panel-default round" style="height: 600px !important">
        <div class="panel-heading margin-bottom-0">
          <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">Choose Parameters</h3>
          <div class="panel-actions">
            <a></a>
          </div>
        </div>
        <div class="panel-body padding-15">
          <div class="col-lg-12" *ngIf="loggedInUser.read_only != true"
            style="padding:0px; margin-top: 10px; margin-bottom: 15px; ">
            <button type="button" class="btn btn-lg btn-primary btn-block btncolor" (click)="clearForm()"
              data-target="#editpop1" data-toggle="modal" style="font-size: 14px;border-radius: 20px;"><i
                class="ri-add-circle-fill"></i>New </button>
          </div>

          <div class="col-lg-12" style="margin-top: 5px; margin-bottom: 5px;">
            <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">

              <!-- dropdown start -->
              <div class="form-group margin-bottom-10">
                <fieldset class="form-fieldset">
                  <legend>Filter</legend>

                  <!-- <p-dropdown [options]="jobTypes" styleClass="prime-dropdown" formControlName="jobtype"
                    placeholder="Select Job Type" (onChange)="onChange($event)">
                  </p-dropdown>
                  <hr> -->
                  <div class="form-group margin-bottom-10">
                    <p-dropdown [options]="shifts_list" formControlName="selectGroup" name="selectedGroup"
                      (onChange)="selectGroupDropDownChange($event)" styleClass="prime-dropdown"
                      placeholder="Select Shift">
                    </p-dropdown>
                  </div>
                  <div class="form-group margin-bottom-10">


                    <p-dropdown [options]="drivers_list" formControlName="selectedDriver" name="selectedDriver"
                      (onChange)="selectDriverDropDownChange($event)" styleClass="prime-dropdown"
                      placeholder="Select driver">
                    </p-dropdown>

                  </div>

                  <!-- </fieldset>
              </div>

              <div class="form-group margin-bottom-10">
                <fieldset class="form-fieldset">
                  <legend>Search</legend> -->

                  <!-- <div class="form-group margin-bottom-10">
                    <div class="input-search">
                      <i class="input-search-icon ri-search-line"></i>
                      <input type="text" class="form-control" formControlName="search" [(ngModel)]="inputValue"
                        name="search" placeholder="Search...">
                      <button type="button" class="input-search-close icon " data-toggle="popover" data-original-title=""
                        data-trigger="hover" data-container="body" data-placement="top" data-html="true" id="help2"><i
                          class="ri-question-line"></i></button>
                      <div id="popover-content-help2" class="hide">
                        Some help information goes here
                      </div>

                    </div>
                  </div> -->


                  <div class="form-group margin-bottom-0 text-center">
                    <!-- <button href="" type="submit" class="btn btn-success btn-round btn-block1"> <i
                        class=" ri-search-line "></i> Search</button> -->
                    <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i
                        class="ri-refresh-line "></i>
                      Clear
                    </button>
                  </div>


                </fieldset>
              </div>


              <hr>

              <!-- Download Buttons start-->
              <div class="form-group margin-bottom-0">
                <label class="font-size-14 font-weight-600 ">Export:</label>
                <div class="btn-group btn-group-justified">
                  <div class="btn-group" role="group">
                    <a [href]="downloadableLink">
                      <button type="button" class="btn btn-outline btn-default"> <img
                          src="../../../assets/images/icon-xls.png" height="50">
                        <div class="font-size-12">
                          <a [href]="downloadableLink" class="enabled">
                            Download XLS </a>
                        </div>
                      </button>
                    </a>
                  </div>
                  <div class="btn-group" role="group">
                    <a [href]="downloadableLink1">
                      <button type="button" class="btn btn-outline btn-default"> <img
                          src="../../../assets/images/icon-pdf.png" height="50">
                        <div class="font-size-12">Download PDF</div>
                      </button>
                    </a>
                  </div>

                </div>
              </div>
              <!--  Download Buttons ends -->
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- table start -->
    <div class="col-lg-8">
      <div class="panel card shadow light panel-default nav-tabs-horizontal padding-0 margin-bottom-30">
        <div class="panel-heading font-weight-600" (click)="resizeDatatableSerivce.recalculate();">
          <div class="panel-title">Driver to Shift Allocations </div>
          <div class="panel-actions">
            <!-- <a class="panel-action icon ion-loop" pTooltip="Refresh" tooltipPosition="top" (click)="getTemplates()"></a>
            <a class="btn btn-sm white no-border   btn-success " href="" data-target="#editpop1" data-toggle="modal"
              (click)="createNewTemplate()"> <i class="ion-plus"></i> Create Job </a> -->
          </div>

        </div>


        <div class="panel-body padding-10">
          <div class="tab-content">
            <div class="col-lg-12">
              <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}" mode="indeterminate">
              </p-progressBar>
              <div class="table-responsive" style="border: 1px solid #ebebeb;">

                <table matSort (matSortChange)="sortUserList($event)"
                  class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1" mat-table
                  [dataSource]="templates" mat-elevation-z8>
                  <ng-container matColumnDef="driver_first_name">
                    <th mat-header-cell *matHeaderCellDef> Driver Name</th>
                    <td mat-cell *matCellDef="let row">
                      {{ (row.driver_first_name == null) ? 'Unasigned': row.driver_first_name + " " +
                      (row.driver_last_name ==
                      'None' ? '' : row.driver_last_name) }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="shift_name">
                    <th mat-header-cell *matHeaderCellDef>Shift Name</th>
                    <td mat-cell *matCellDef="let row">
                      {{(row.shift_name == null) ? 'N/A': row.shift_name}}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="start_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Start Date</th>
                    <td mat-cell *matCellDef="let row">
                      {{(row.start_date == null) ? 'N/A': row.start_date | date: 'MM/dd/yyyy'}}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="end_date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>End Date</th>
                    <td mat-cell *matCellDef="let row">
                      {{(row.end_date == null) ? 'N/A': row.end_date | date: 'MM/dd/yyyy'}}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="shift_start_time">
                    <th mat-header-cell *matHeaderCellDef>Start Time</th>
                    <td mat-cell *matCellDef="let row">
                      {{ row.shift_start_time ? timeConversion(row.shift_start_time) : 'N/A' }}

                    </td>
                  </ng-container>
                  <ng-container matColumnDef="shift_end_time">
                    <th mat-header-cell *matHeaderCellDef>End Time</th>
                    <td mat-cell *matCellDef="let row">
                      {{ row.shift_end_time ? timeConversion(row.shift_end_time) : 'N/A' }}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Status</th>
                    <td mat-cell *matCellDef="let row">
                      <span class="label"
                        [ngClass]="(row.status === EntityStatusEnum.Active)? 'label-success': 'label-danger'">
                        {{(row.status === EntityStatusEnum.Active)? 'Active' : 'Inactive'}}
                      </span>
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="actions">
                    <th mat-header-cell *matHeaderCellDef>ACTIONS</th>
                    <td mat-cell *matCellDef="let row">
                      <button type="button" *ngIf="loggedInUser.read_only != true" class="btn btn-icon  btn-info btn-xs"
                        data-target="#editpop1" #testOpen (click)="openEditModal(row)" data-toggle="modal"
                        pTooltip="Edit">
                        <i class="icon ion-edit"></i>
                      </button>
                      <button type="button" *ngIf="loggedInUser.read_only != true" pTooltip="Delete"
                        class="btn btn-icon  btn-danger btn-xs" (click)="showSwal(row)" data-original-title="Delete"> <i
                          class="icon ion-android-delete"></i> </button>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedUserList"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedUserList;"></tr>
                </table>
                <div *ngIf="templates?.length === 0" class="no-records">No records found</div>
                <mat-paginator translate="no" #userPaginator [length]="totalUserLength" [hidePageSize]="true"
                  showFirstLastButtons (page)="onUserPagination($event)" [pageSize]="10">
                </mat-paginator>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>