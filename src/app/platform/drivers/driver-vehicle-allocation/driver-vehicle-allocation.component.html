<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' " #scrollToTop [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow " [hidden]="!isAuthorized">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <li><a routerLink="/iol/drivers/allocation">Vehicle Allocations</a></li>
  </ol>
</div>

<div [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "  style="padding-bottom:200px">
  <div class="panel-heading font-weight-600 margin-bottom-0">
  </div>

  <div class="panel-body padding-0">
    <div class="tab-content">
      <div class="tab-pane active" id="Summary">
        <div class=" margin-bottom-0 ">
          <div class="panel-body padding-15 ">
            <div class="row">

              <div class="col-lg-4 card-group-row__col">
                <div class="panel panel-default round  ">

                  <div class="panel-heading" style=" margin-bottom: 0px;">
                    <h3 class="panel-title font-weight-600 " style="color: #37474f;">
                      Choose Parameters
                    </h3>
                    <div class="panel-actions">
                      <a class="panel-action"></a>
                    </div>
                  </div>
                  <div class="col-lg-10" *ngIf="loggedInUser.read_only != true"
                    style="padding:0px; margin-top: 10px; margin-bottom: 15px;margin-left: 25px;">
                    <button type="button" class="btn btn-lg btn-primary btn-block btncolor" (click)="clearForm()"
                      data-target="#editpop1" data-toggle="modal" style="font-size: 14px;border-radius: 20px;">
                      <i class="ri-add-circle-fill"></i>Add Allocations </button>
                  </div>

                  <div class="col-lg-12" style="margin-top: 5px; margin-bottom: 5px;">
                    <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">
                      <!-- <div class="form-group">
                        <h5 class=" font-weight-600 ">Search</h5>
                        <div class="panel-actions">
                          <a class="panel-action "></a>
                        </div>
                        <input type="text" class="form-control input-sm" formControlName="search" placeholder="Search"
                          (keyup)='keyUp.next($event)' style="height: 36px;">
                      </div> -->
                      <!-- <hr> -->
                      <div class="form-group margin-bottom-10">
                        <fieldset class="form-fieldset">
                          <legend>Filters</legend>

                          <!-- <div class="form-group margin-bottom-10">
                                <div class="input-search">
                                    <i class="input-search-icon ri-search-line"></i>
                                    <input type="text" class="form-control" formControlName="search" name="" placeholder="Search...">
                                    <button type="button" class="input-search-close icon " data-toggle="popover" data-original-title="" data-trigger="hover" data-container="body" data-placement="top" data-html="true" id="help2" pTooltip='Search' tooltipPosition="top"><i class="ri-question-line"></i></button>
                                    <div id="popover-content-help2" class="hide">
                                        Some help information goes here
                                    </div>

                                </div>
                            </div> -->
                          <div class="form-group margin-bottom-10">
                            <!-- <div class="btn-group bootstrap-select form-control">
                                  driverGroup -->
                            <p-dropdown [options]="vehicleListing" formControlName="selectGroup" name="selectedGroup"
                              (onChange)="selectDriverDropDownChange($event)" styleClass="prime-dropdown"
                              placeholder="Select Vehicle">
                            </p-dropdown>
                            <!-- </div> -->
                          </div>
                          <div class="form-group margin-bottom-10">
                            <!-- <div class="btn-group bootstrap-select form-control"> -->
                            <p-dropdown [options]="driverDropdown" formControlName="selectedDriver"
                              name="selectedDriver" (onChange)="selectVehicleDropDownChange($event)"
                              styleClass="prime-dropdown" placeholder="Select driver">
                            </p-dropdown>
                            <!-- </div> -->
                          </div>

                          <!--
                            <div class="form-group margin-bottom-0 text-center">
                                <button href="" type="submit" class="btn btn-success btn-round btn-block1" > <i class=" ri-search-line "></i> Search</button>
                                <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i class="ri-refresh-line "></i>
                                    Clear
                                </button>
                            </div> -->



                          <!-- </fieldset>
                        <fieldset class="form-fieldset">
                          <legend>Search</legend> -->

                          <!-- <div class="form-group margin-bottom-10">
                            <div class="input-search">
                              <i class="input-search-icon ri-search-line"></i>
                              <input type="text" class="form-control" formControlName="search" name=""
                                placeholder="Search...">
                              <button type="button" class="input-search-close icon " data-toggle="popover"
                                data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                                data-html="true" id="help2" pTooltip='Name,Email' tooltipPosition="top">
                                <i class="ri-question-line"></i>
                              </button>
                              <div id="popover-content-help2" class="hide">
                                Some help information goes here
                              </div>

                            </div>
                          </div> -->


                          <div class="form-group margin-bottom-0 text-center">
                            <!-- <button href="" type="submit" class="btn btn-success btn-round btn-block1"> <i
                                class=" ri-search-line "></i> Search</button> -->
                            <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i
                                class="ri-refresh-line "></i>
                              Clear
                            </button>
                          </div>


                        </fieldset>
                      </div>
                      <!-- <div class="col-lg-12" style="padding:0px; margin-top: 10px; margin-bottom: 15px;">
                        <button class="btn btn-lg btn-primary btn-block btncolor"
                        type="submit"        style="font-size: 14px;border-radius: 20px;">
                         Show Allocations </button>
                      </div> -->

                      <div class="col-lg-12">
                        <hr>
                      </div>
                      <hr>
                      <div class="form-group margin-bottom-0">
                        <label class="font-size-14 font-weight-600 ">Export:</label>
                        <div class="btn-group btn-group-justified">
                          <div class="btn-group" role="group">
                            <a [href]="downloadableLink">
                              <button type="button" class="btn btn-outline btn-default"> <img
                                  src="../../../assets/images/icon-xls.png" height="50">
                                <div class="font-size-12">
                                  <a [href]="downloadableLink" class="enabled">
                                    Download XLS </a>
                                </div>
                              </button>
                            </a>
                          </div>
                          <div class="btn-group" role="group">
                            <a [href]="downloadableLink1">
                              <button type="button" class="btn btn-outline btn-default"> <img
                                  src="../../../assets/images/icon-pdf.png" height="50">
                                <div class="font-size-12">Download PDF</div>
                              </button>
                            </a>
                          </div>

                        </div>
                      </div>
                    </form>
                  </div>

                  <!-- comment out for now as  -->
                  <!-- <div class="col-lg-12">
                    <div class="panel-heading " style="background:#E60000;margin-bottom: 0px;">
                      <h3 class="panel-title font-weight-600 " style="color: white;">
                        Export: Fuel
                      </h3>
                      <div class="panel-actions">
                        <a class="panel-action ">.</a>
                      </div>
                    </div>

                    <br>

                    <div class="row">
                      <div class="col-sm-6" style="text-align: center;">
                        <div style="margin-left: 80px;">
                          <span class=""> <img src="/assets/images/pdf.png" alt="img" style="max-height: 60px;"> </span>
                        </div>
                      </div>
                      <div class="col-sm-6" style="text-align: center;">
                        <div style="margin-right: 80px;">
                          <span class=""> <img src="/assets/images/xls.png" alt="img" style="max-height: 60px;"> </span>
                        </div>
                      </div>
                    </div>
                    <hr>
                  </div> -->
                </div>
              </div>

              <div class="col-lg-8">
                <div class="row">


                  <div class="col-lg-12">
                    <!-- <div>Driver to Vehicle Allocations</div>
                        <hr>
                        <div class="row">
                          <div class="col-lg-4">
                            <div class="form-group margin-bottom-10">
                                  <div class="input-search">
                                  <i class="input-search-icon ri-search-line"></i>
                                  <input type="text" class="form-control" formControlName="search" name="" placeholder="Search...">
                                  <button type="button" class="input-search-close icon " data-toggle="popover" data-original-title="" data-trigger="hover" data-container="body" data-placement="top" data-html="true" id="help2" pTooltip='Search' tooltipPosition="top"><i class="ri-question-line"></i></button>
                                  <div id="popover-content-help2" class="hide">
                                      Some help information goes here
                                  </div>

                                  </div>
                              </div>
                          </div>
                        </div> -->


                    <div class="panel panel-default  padding-0  card  light"
                      style="min-height: 200px; color: aliceblue;">

                      <div class="panel-heading margin-bottom-0">
                        <h3 class="panel-title font-weight-600 bg-theme1 white1 "> Driver to Vehicle Allocations
                          <a data-toggle="popover" class="  font-weight-200 margin-left-10 grey-400"
                            data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                            data-html="true" href="#" id="help1">
                            <!-- <i class="ri-information-line"></i> -->
                          </a>
                        </h3>
                        <div id="popover-content-help1" class="hide">
                          Some help information goes here
                        </div>



                        <div class="panel-actions">
                          <a></a>
                        </div>
                      </div>


                      <!-- <div class="input-search" style="max-width:30%;    margin-bottom: -8px;margin-top: 13px;margin-left: 10px;">
                          <i class="input-search-icon ri-search-line"></i>
                          <input type="text" class="form-control" name="" placeholder="Search..." (keyup)='keyUp.next($event)'>
                          <button type="button" class="input-search-close icon " data-toggle="popover" data-original-title="" data-trigger="hover" data-container="body" data-placement="top" data-html="true" id="help2">
                          </button>
                          <div id="popover-content-help2" class="hide">
                              Some help information goes here
                          </div>
                      </div> -->



                      <div class="table-responsive panel-body padding-15" style="border: 1px solid #ebebeb;">
                        <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}"
                          mode="indeterminate"></p-progressBar>

                        <table matSort (matSortChange)="sortDrivers($event)"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1"
                          mat-table [dataSource]="drivers" mat-elevation-z8>

                          <ng-container matColumnDef="vehicle_name">
                            <th mat-header-cell *matHeaderCellDef>VEHICLE</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.vehicle_name == null) ? 'N/A': row.vehicle_name }}
                              <!-- <div style="width: 160px; float: left">
                                  <img [src]="row.user_image || '../assets/images/default_user.png'"
                                    class="img-bordered pull-left margin-right-10" height="36px" />

                                  <div class="media-body pointer" [routerLink]="gotoService.gotoDriver(row.id)">
                                    <a class="font-weight-600">{{ (row.vehicle_name == null) ? 'N/A': row.vehicle_name }}</a>
                                  </div>
                                </div> -->
                            </td>
                          </ng-container>
                          <ng-container matColumnDef="driver_first_name">
                            <th mat-header-cell *matHeaderCellDef>DRIVER NAME</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.driver_first_name == null) ? 'N/A': row.driver_first_name + " " +
                              (row.driver_last_name == 'None' ? '' : row.driver_last_name) }}
                            </td>
                          </ng-container>
                          <!-- <ng-container matColumnDef="driver_last_name">
                              <th mat-header-cell *matHeaderCellDef >DRIVER LAST NAME</th>
                              <td mat-cell *matCellDef="let row">

                                  {{ (row.driver_last_name == null) ? 'N/A': row.driver_last_name }}

                              </td>
                            </ng-container> -->
                          <ng-container matColumnDef="start_date">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>START DATE</th>
                            <td mat-cell *matCellDef="let row">
                              <!-- style="color: black !important" -->
                              <!-- {{ (row.start_date == null) ? 'N/A': row.start_date }} -->
                              {{ (row.start_date | date: 'M/d/yyyy') || 'N/A' }}
                            </td>
                          </ng-container>
                          <ng-container matColumnDef="end_date">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>END DATE</th>
                            <td mat-cell *matCellDef="let row">
                              <!-- {{ (row.end_date == null) ? 'N/A': row.end_date }} -->
                              {{ (row.end_date | date: 'M/d/yyyy') || 'N/A' }}
                            </td>
                          </ng-container>
                          <!-- <ng-container matColumnDef="modified_datetime">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header>MODIFIED DATETIME</th>
                              <td mat-cell *matCellDef="let row">
                                {{ (row.modified_datetime | date: 'M/d/yyyy, h:mm:ss a') || 'N/A' }}</td>
                            </ng-container> -->
                          <!-- <ng-container matColumnDef="created_datetime">
                              <th mat-header-cell *matHeaderCellDef mat-sort-header>CREATED DATETIME</th>
                              <td mat-cell *matCellDef="let row">
                                {{ (row.created_datetime | date: 'M/d/yyyy, h:mm:ss a') || 'N/A' }}</td>
                            </ng-container> -->
                          <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Actions</th>
                            <td mat-cell *matCellDef="let row">
                              <button type="button" *ngIf="loggedInUser.read_only != true"
                                class="btn btn-icon  btn-info btn-xs " data-target="#editpop1" data-toggle="modal"
                                pTooltip="Edit" (click)="openEditModal(row)">
                                <i class="icon ion-edit"></i>
                              </button>
                              <button type="button" *ngIf="loggedInUser.read_only != true" pTooltip="Delete "
                                class="btn btn-icon  btn-danger btn-xs " (click)="showSwal(row)"
                                data-original-title="Delete"> <i class="icon ion-android-delete"></i>
                              </button>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedDriverList"></tr>
                          <tr mat-row *matRowDef="let row; columns: displayedDriverList;"></tr>
                        </table>

                        <div *ngIf="drivers?.length === 0" class="no-records">No records found</div>

                        <mat-paginator translate="no" #driverPaginator [length]="totalDriverLength" [hidePageSize]="true"
                          showFirstLastButtons (page)="onDriverPagination($event)" [pageSize]="10">
                        </mat-paginator>
                      </div>

                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div #formModal class="modal fade  modal-success text-left" id="editpop1" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center  modal-md">
    <div class="modal-content">
      <div class="modal-header" [ngStyle]="theme">
        <button type="button" class="close" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title">{{inactiveRecord ? 'View Driver' : formTitle}}</h4>
      </div>

      <div class="modal-body">
        <div class="">
          <div class="row">
            <div class="">
              <form novalidate [formGroup]="driverForm" id="driverFormID" (ngSubmit)="onSubmit(driverForm.value)">
                <fieldset [disabled]="inactiveRecord">
                  <div class="">
                    <div class="col-md-12">
                      <div class="row">
                        <div class="col-sm-5">
                          <div class="form-group">
                            <label class="control-label">Driver<span class="text-danger2">*</span>
                              <!-- <span class="text-danger2">*</span> -->
                            </label>
                            <div class="input-icon">
                              <!-- [(ngModel)]="driver_id" -->
                              <p-dropdown [options]="driverDropdown" formControlName="driver_id" name="selectedGender"
                                styleClass="prime-dropdown" placeholder="Select driver">
                              </p-dropdown>
                              <!-- <input *ngIf="inactiveRecord" class="form-control" formControlName="driver" /> -->

                              <span class="error-message"
                                *ngIf="driverForm.get('driver_id').getError('required') && submitted"> Please
                                provide driver name
                              </span>
                            </div>
                          </div>
                        </div>

                        <div class="col-sm-5">
                          <div class="form-group">
                            <label class="control-label">Vehicles<span class="text-danger2">*</span>
                              <!-- <span class="text-danger2">*</span> -->
                            </label>
                            <div class="input-icon">
                              <p-dropdown [options]="vehicleListing" name="selectedMaritalStatus"
                                [(ngModel)]="selectedMaritalStatus" formControlName="vehicle_id"
                                styleClass="prime-dropdown" placeholder="Select vehicle">
                              </p-dropdown>
                              <!-- <input *ngIf="inactiveRecord" class="form-control" formControlName="marital_status_id" />
                                                    -->
                              <span class="error-message"
                                *ngIf="driverForm.get('vehicle_id').getError('required') && submitted"> Please
                                provide fleet to driver</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="row">


                        <div class="col-sm-5">

                          <div class="form-group">
                            <label class="control-label">Start Date <span
                                class="required  text-danger2">*</span></label>
                            <div class="input-icon">
                              <!-- [(ngModel)]="contractStartDate" -->
                              <p-calendar [readonlyInput]="true" [(ngModel)]="contractStartDate" name="joiningDate"
                              showTime="true" hourFormat="24"
                                placeholder="MM/DD/YYYY" styleClass="prime-datetime" formControlName="start_date">
                              </p-calendar>
                              <span class="error-message" style="position: relative!important;"
                                *ngIf="driverForm.get('start_date').getError('required') && submitted"> Please
                                provide start date</span>
                            </div>
                          </div>
                        </div>

                        <div class="col-sm-5">

                          <div class="form-group">
                            <label class="control-label">End Date <span class="required  text-danger2">*</span></label>
                            <div class="input-icon">
                              <!-- [(ngModel)]="contractEndDate" [disabled]="!contractStartDate" -->
                              <p-calendar [disabled]="!contractStartDate" [readonlyInput]="true"
                                [(ngModel)]="contractEndDate" name="endDate" placeholder="MM/DD/YYYY"
                                showTime="true" hourFormat="24"
                                [minDate]="contractStartDate" styleClass="prime-datetime" formControlName="end_date">
                              </p-calendar>
                              <span class="error-message" style="position: relative!important;"
                                *ngIf="driverForm.get('end_date').getError('required') && submitted"> Please
                                provide end date</span>
                            </div>
                          </div>
                        </div>


                      </div>



                    </div>


                  </div>
                </fieldset>

              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-round btn-block1" #closeForm
          data-dismiss="modal">Close</button>
        <button type="submit" [disabled]="btnLoading" class="btn btn-success btn-round btn-block1"
          form="driverFormID">{{btnText}}</button>
        <!-- [disabled]="inactiveRecord || !driverForm.valid || btnLoading || notImage" -->
      </div>
    </div>
  </div>
</div>
