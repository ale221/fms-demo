<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' " [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow ">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <!-- <li><a> User & Admin</a></li>
    <li><a routerLink="/iol/admin/customer">Customer</a></li> -->
    <!-- <li><a (click)="pageReload()"> User & Admin</a></li> -->
    <li><a (click)="pageReload()">Customer</a></li>
  </ol>
</div>
<div [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "  style="padding-bottom:200px" [hidden]="!isAuthorized">
  <div class="panel-heading font-weight-600 margin-bottom-0">
  </div>

  <div class="panel-body padding-0">
    <div class="tab-content">
      <div class="tab-pane active" id="Summary">
        <div class="panel panel-default margin-bottom-0 ">
          <div class="panel-body padding-15 ">
            <div class="row">

              <div class="col-lg-4">
                <!-- <div class="panel-heading" style="background:#E60000; margin-bottom: 0px;">
                  <h3 class="panel-title font-weight-600 " style="color: white;">
                    Choose Parameters
                  </h3>
                  <div class="panel-actions">
                    <a class="panel-action"></a>
                  </div>
                </div> -->

                <div class="col-lg-12" *ngIf="loggedInUser.read_only != true"
                  style="padding:0px; margin-top: 10px; margin-bottom: 15px;">
                  <button #editpop type="button" class="btn btn-lg btn-primary btn-block btncolor" (click)="clearForm()"
                    data-target="#editpop1" data-toggle="modal" style="font-size: 14px;border-radius: 20px;">
                    <i class="ri-add-circle-fill"></i> New
                  </button>
                </div>

                <div class="col-lg-12" style="margin-top: 5px; margin-bottom: 5px;">
                  <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">
                    <!-- <div class="form-group">
                      <h5 class=" font-weight-600 ">Search</h5>
                      <div class="panel-actions">
                        <a class="panel-action "></a>
                      </div>
                      <input type="text" class="form-control input-sm" formControlName="search"
                        (keyup)='keyUp.next($event)' placeholder="Search" style="height: 36px;">
                    </div> -->
                    <div class="form-group margin-bottom-10">
                      <fieldset class="form-fieldset">
                        <legend>Search</legend>

                        <div class="form-group margin-bottom-10">
                          <div class="input-search">
                            <i class="input-search-icon ri-search-line"></i>
                            <input type="text" class="form-control" formControlName="search" name=""
                              placeholder="Search...">
                            <button type="button" class="input-search-close icon " data-toggle="popover"
                              data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                              data-html="true" id="help2" pTooltip='Name,PartyCode' tooltipPosition="top"><i
                                class="ri-question-line"></i></button>
                            <div id="popover-content-help2" class="hide">
                              Some help information goes here
                            </div>
                          </div>
                        </div>

                        <div class="form-group margin-bottom-0 text-center">
                          <button href="" type="submit" class="btn btn-success btn-round btn-block1"> <i
                              class=" ri-search-line "></i> Search</button>
                          <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i
                              class="ri-refresh-line "></i>
                            Clear
                          </button>
                        </div>
                      </fieldset>
                    </div>

                    <!-- <div class="form-group">
                      <p-dropdown [options]="statusList" formControlName="searchStatus" name="selectedGroup"
                        (onChange)="searchStatusDropDownChange($event)" styleClass="prime-dropdown"
                        placeholder="Select status">
                      </p-dropdown>
                    </div> -->
                    <hr>
                    <div class="form-group margin-bottom-0">
                      <label class="font-size-14 font-weight-600 ">Export:</label>
                      <div class="btn-group btn-group-justified">
                        <div class="btn-group" role="group">
                          <a (click)="downloadXLS(downloadableLink)">
                            <button type="button" class="btn btn-outline btn-default"> <img
                                src="../../../assets/images/icon-xls.png" height="50">
                              <div class="font-size-12">
                                <!-- [href]="downloadableLink" -->
                                <a  class="enabled">
                                  Download XLS </a>
                              </div>
                            </button>
                          </a>
                        </div>
                        <div class="btn-group" role="group">
                          <a (click)="downloadPDF(downloadableLink1)">
                            <button type="button" class="btn btn-outline btn-default"> <img
                                src="../../../assets/images/icon-pdf.png" height="50">
                              <div class="font-size-12">Download PDF</div>
                            </button>
                          </a>
                        </div>

                      </div>
                    </div>

                  </form>
                </div>

                <!-- comment out for now as  -->
                <!-- <div class="col-lg-12">
                  <div class="panel-heading " style="background:#E60000;margin-bottom: 0px;">
                    <h3 class="panel-title font-weight-600 " style="color: white;">
                      Export: Fuel
                    </h3>
                    <div class="panel-actions">
                      <a class="panel-action ">.</a>
                    </div>
                  </div>

                  <br>

                  <div class="row">
                    <div class="col-sm-6" style="text-align: center;">
                      <div style="margin-left: 80px;">
                        <span class=""> <img src="/assets/images/pdf.png" alt="img" style="max-height: 60px;"> </span>
                      </div>
                    </div>
                    <div class="col-sm-6" style="text-align: center;">
                      <div style="margin-right: 80px;">
                        <span class=""> <img src="/assets/images/xls.png" alt="img" style="max-height: 60px;"> </span>
                      </div>
                    </div>
                  </div>
                  <hr>
                </div> -->
              </div>

              <div class="col-lg-8">
                <div class="row">
                  <div class="col-lg-12">
                    <div class="panel panel-default  padding-0  card  light"
                      style="min-height: 200px; color: aliceblue;">
                      <div class="panel-heading" style="margin-bottom: 0px;">
                        <div class="panel-actions">
                          <!-- <a *ngIf="!enableSearch" class="panel-action icon ion-loop" data-toggle="tooltip" pTooltip="Refresh"
                            tooltipPosition="top" (click)="getContracts()"></a> -->
                          <!-- <a class="btn btn-sm white no-border   btn-success " href="" data-target="#editpop1" data-toggle="modal"
                            (click)="AdButtonClick()"> <i class="ion-plus"></i> Add New Contract</a> -->
                        </div>
                        <h3 class="panel-title "><b>List</b></h3>
                      </div>
                      <div class="table-responsive margin-top-20" style="border: 1px solid #ebebeb;">
                        <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}"
                          mode="indeterminate"></p-progressBar>

                        <table matSort (matSortChange)="sortUserList($event)"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1"
                          mat-table [dataSource]="users" mat-elevation-z8>
                          <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>NAME</th>
                            <td mat-cell *matCellDef="let row">
                              {{(row.name == null) ? 'N/A': row.name}}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
                            <td mat-cell *matCellDef="let row">
                              <span class="label"
                                [ngClass]="(row.status === EntityStatusEnum.Active)? 'label-success': 'label-danger'">
                                {{(row.status === EntityStatusEnum.Active)? 'Active' : 'Inactive'}}
                              </span>
                              <!-- {{ (row.status_label == null) ? 'N/A': row.status_label }}</td> -->
                          </ng-container>

                          <ng-container matColumnDef="party_code">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Party Code</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.party_code == null) ? 'N/A': row.party_code }}</td>
                          </ng-container>

                          <ng-container matColumnDef="modified_by">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Modified By</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.modified_by_name == null) ? 'N/A': row.modified_by_name }}</td>
                          </ng-container>

                          <ng-container matColumnDef="modified_datetime">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Modified Datetime</th>
                            <td mat-cell *matCellDef="let row">
                              {{(row.modified_datetime == null)?'N/A':row.modified_datetime | date: 'MM/dd/yyyy h:mm:ss a'
                              }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="created_datetime">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Created Datetime</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.created_datetime == null) ? 'N/A': row.created_datetime | date: 'MM/dd/yyyy h:mm:ss a'
                              }}</td>
                          </ng-container>

                          <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>ACTIONS</th>
                            <td mat-cell *matCellDef="let row">
                              <button *ngIf="loggedInUser.read_only != true" type="button"
                                class="btn btn-icon  btn-info btn-xs" (click)="openEditModal(row)"
                                data-target="#editpop1" data-toggle="modal" pTooltip="Edit">
                                <i class="icon ion-edit"></i>
                              </button>
                              <button *ngIf="loggedInUser.read_only != true" type="button" pTooltip="Delete "
                                class="btn btn-icon  btn-danger btn-xs " (click)="showSwal(row)"
                                data-original-title="Delete"><i class="icon ion-android-delete"></i>
                              </button>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedUserList"></tr>
                          <tr mat-row *matRowDef="let row; columns: displayedUserList;"></tr>
                        </table>
                        <div *ngIf="users?.length === 0" class="no-records">No records found</div>
                        <mat-paginator translate="no" #userPaginator [length]="totalUserLength" [hidePageSize]="true"
                          showFirstLastButtons (page)="onUserPagination($event)" [pageSize]="10">
                        </mat-paginator>
                      </div>

                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div #formModal class="modal fade  modal-success text-left" id="editpop1" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center modal-lg">
    <!--modal-lg-->
    <div class="modal-content">
      <div class="modal-header" [ngStyle]="theme">
        <button type="button" class="close" (click)="submitted = false" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title">{{formTitle}}</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-12">
            <!--User Profile Form-->
            <form [formGroup]="clientForm" id="clientFormID" (ngSubmit)="onSubmit(clientForm.value)">
              <fieldset>
                <div class="row">
                  <div class="col-lg-12">
                    <div class="col-sm-4">
                      <div class="form-group">
                        <label class="control-label form-label">Name <span
                            class="required  text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="name" maxlength="40" />
                          <span class="error-message"
                            *ngIf="clientForm.get('name').getError('required') && submitted">Name is Required.
                          </span>
                          <span class="error-message"
                            *ngIf="clientForm.get('name').getError('isAlphabetsAndSpace') && submitted">Enter Alphabets
                            only.
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="form-group">
                        <label class="control-label form-label">Party Code <span
                            class="required  text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="party_code" maxlength="40" />
                          <span class="error-message"
                            *ngIf="clientForm.get('party_code').getError('required') && submitted">Party Code is
                            Required.
                          </span>
                          <span class="error-message" *ngIf="clientForm.get('party_code').getError('pattern') && submitted">
                            Avoid white spaces
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="form-group">
                        <label class="control-label form-label">Email <span
                            class="required  text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="email" maxlength="45" />
                          <!-- <span class="error-message"
                          *ngIf="clientForm.get('email').getError('required') && submitted">Email is Required.
                        </span>
                          <span class="error-message"
                            *ngIf="clientForm.get('email').dirty && clientForm.get('email').getError('required')">Please
                            enter valid email.</span> -->
                          <span class="error-message" style="position: relative !important">
                            <span *ngIf="clientForm.get('email').getError('required') && submitted">
                              Email is Required.
                            </span>

                            <span
                              *ngIf="clientForm.get('email').dirty && clientForm.get('email').getError('email') || clientForm.get('email')?.errors?.pattern">
                              Please enter valid email.
                            </span>
                          </span>

                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="form-group">
                        <label class="control-label">Contact Number <span
                            class="required  text-danger2">*</span></label>
                        <div class="input-icon">
                          <p-inputMask formControlName="contact_number" mask="+999-9999-9999" maxlength="15"
                            characterPattern="[0-9+]" placeholder="+999-9999-9999" [styleClass]="'form-control'">
                          </p-inputMask>
                          <span class="error-message"
                            *ngIf="clientForm.get('contact_number').getError('required') && submitted">Contact Number is
                            Required.
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4">
                      <div class="form-group">
                        <label class="control-label">NTN Number <span class="required  text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" type="text" formControlName="ntn_number" maxlength="40" />
                          <span class="error-message"
                            *ngIf="clientForm.get('ntn_number').getError('required') && submitted">NTN Number is
                            Required.
                          </span>
                          <span class="error-message"
                            *ngIf="clientForm.get('ntn_number').getError('isNumbers') && submitted">Enter only Numbers.
                          </span>
                          <!-- <span class="error-message"
                          *ngIf="clientForm.get('ntn_number').dirty && clientForm.get('email').getError('email')">Please
                          enter valid email.</span> -->
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4" *ngIf="btnText === 'Update'">
                      <div class="form-group margin-top-35">
                        <label class="control-label"><input formControlName="status" type="checkbox" value=""><span
                            style="margin-left: 5px;">Status</span></label>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="col-sm-6">
                          <div class="form-group">
                            <label class="control-label">Address <span class="required  text-danger2">*</span></label>
                            <div class="input-icon">
                              <textarea class="form-control" formControlName="address" maxlength="100"
                                style="resize: none;"></textarea>
                              <span class="error-message"
                                *ngIf="clientForm.get('address').getError('required') && submitted">Address is Required.
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="form-group">
                            <label class="control-label">Description <span
                                class="required  text-danger2 text-danger2 ">*</span></label>
                            <div class="input-icon">
                              <textarea class="form-control" formControlName="description" maxlength="100"
                                style="resize: none;"></textarea>
                              <span class="error-message"
                                *ngIf="clientForm.get('description').getError('required') && submitted">Description is
                                Required.
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- <div class="col-lg-5">
                        <div class="col-lg-12">
                          <div class="">
                            <div class="padding-20 padding-bottom-0 padding-top-0">
                              <div class="form-group">
                                <label class="control-label">Logo</label>
                                <div class="input-icon">
                                  <div class="margin-bottom-10" id="preview">
                                    <div class="container1">
                                      <img #img
                                           [src]="avatar_url? avatar_url : defaultImagePath"
                                           class="img-rounded img-bordered img-bordered-green"
                                           width="150px" height="150px">
                                      <div class="middle">
                                        <button *ngIf="avatar_url" type="button" class="btn btn-sm btn-primary"
                                                (click)="removeImage()">Remove
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  <input #myInput type="file" accept="image/*" (change)="fileChange($event)"
                                         formControlName="photo_method" class="btn btn-default btn-block">
                                </div>
                                <span>
                          <div class="alert alert-danger padding-8" *ngIf="notImage">Please choose only (/jpg, .png images).</div>
                        </span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div> -->
                    </div>


                  </div>
                </div>
              </fieldset>
              <!-- <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label">First Name<span class="text-danger2">*</span></label>
                    <input type="text" formControlName="first_name" maxlength="25" class="form-control" />

                    <span class="error-message" *ngIf="clientForm.get('first_name').getError('required') && submitted">
                      Please provide first name
                    </span>

                    <span class="error-message"
                      *ngIf="clientForm.get('first_name').getError('isAlphabetsAndNumbers') && submitted">Enter
                      alphabets/numbers only
                    </span>



                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label">Last Name<span class="text-danger2">*</span></label>
                    <input type="text" formControlName="last_name" maxlength="25" class="form-control" />

                    <span class="error-message" *ngIf="clientForm.get('last_name').getError('required') && submitted">
                      Please provide last name
                    </span>

                    <span class="error-message"
                      *ngIf="clientForm.get('last_name').getError('isAlphabetsAndNumbers') && submitted">Enter
                      alphabets/numbers only
                    </span>


                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label">Email<span class="text-danger2">*</span></label>
                    <input type="text" formControlName="email" class="form-control" placeholder="name@example.com" />


                    <span class="error-message" style="position: relative !important">
                      <span
                        *ngIf="clientForm.get('email').getError('email') && submitted && clientForm.get('email').value">Please
                        provide proper email
                      </span>

                      <span *ngIf="clientForm.get('email').getError('required') && submitted">
                        Please provide email
                      </span>



                    </span>



                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label">Group<span class="text-danger2">*</span></label>
                    <p-dropdown [(ngModel)]="selectedGroup" *ngIf="!inactiveRecord" [options]="mapArrayGroups"
                      formControlName="group" name="selectedGroup" (onChange)="groupDropDownChange($event)"
                      styleClass="prime-dropdown" placeholder="Select Group Type">
                    </p-dropdown>
                    <input *ngIf="inactiveRecord" class="form-control" formControlName="group" />
                    <span class="error-message" *ngIf="clientForm.get('group').getError('required') && submitted"> Please
                      provide group</span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6" *ngIf="!selectedUserId">
                  <div class="form-group">
                    <label class="control-label">Password<span class="text-danger2">*</span></label>
                    <input type="password" maxlength="25" autocomplete="new-password" formControlName="password"
                      class="form-control" />

                    <span class="error-message" *ngIf="clientForm.get('password').getError('required') && submitted">
                      Please provide password</span>
                  </div>
                </div>
                <div class="col-sm-6" *ngIf="!selectedUserId">
                  <div class="form-group">
                    <label class="control-label">Confirm Password<span class="text-danger2">*</span></label>
                    <input type="password" maxlength="25" formControlName="confirm_password" class="form-control" />

                    <span class="error-message"
                      *ngIf="((clientForm.get('confirm_password').getError('required') && submitted))"> Please provide
                      confirm password</span>
                    <span class="error-message"
                      *ngIf="( ( (clientForm.get('confirm_password').value && clientForm.get('confirm_password').value) &&  (clientForm.get('confirm_password').value !== clientForm.get('password').value)))">
                      Password does not match </span>
                  </div>
                </div>

                <div class="col-sm-6" *ngIf="selectedUserId">
                  <div class="form-group">
                    <label class="control-label"><b>Status<span class="text-danger">*</span></b></label>

                    <p-dropdown [(ngModel)]="selectedStatus" *ngIf="!inactiveRecord" [options]="statusList"
                      formControlName="status" name="selectedGroup" (onChange)="statusDropDownChange($event)"
                      styleClass="prime-dropdown" placeholder="Select status">
                    </p-dropdown>

                  </div>
                </div>

              </div> -->
            </form>
            <!-- User Profile Form-->
            <app-spin-loading [appLoader]="true"></app-spin-loading>
          </div>
        </div>
      </div>
      <!--<ul>-->
      <!--<li *ngFor="let error of errorMessages" class="text-danger">{{error}}</li>-->
      <!--</ul>-->
      <div class="modal-footer">
        <button type="button" #closeForm (click)="submitted = false" class="btn btn-default btn-round btn-block1"
          data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-success btn-round btn-block1" form="clientFormID"
          [disabled]="!addUser">{{btnText}}</button>
      </div>
    </div>
  </div>
</div>

<div #formModal2 class="modal fade  modal-success text-left" id="editpop2" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center  ">
    <!--modal-lg-->
    <div class="modal-content">
      <div class="modal-header" [ngStyle]="theme">
        <button type="button" class="close" (click)="submitted = false" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title">Bulk Upload</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-12">

            <form novalidate [formGroup]="bulkUploadForm" id="bulkUploadFormID"
              (ngSubmit)="bulkUploadSubmit(bulkUploadForm.value)">
              <div class="row">
                <div class="col-lg-12">
                  <div class="padding-20 padding-bottom-0 padding-top-0">
                    <div class="form-group">

                      <button class="file-upload-btn" type="button"
                        onclick="$('.file-upload-input').trigger( 'click' )">
                        Browse</button>

                      <span class="fileName-padding" *ngIf="selectedFileName != '' && !notCSVExcel">
                        {{selectedFileName}}
                      </span>

                      <span class="alert alert-danger fileName-padding" *ngIf="notCSVExcel">
                        Please choose only (CSV, Excel files)
                      </span>

                      <span class="pull-right">

                      </span>

                      <div class="image-upload-wrap">
                        <input class="file-upload-input" type='file' (change)="fileChange($event)"
                          accept=".csv, .ms-excel, .xlsx" formControlName="csvFiles" />

                        <div class="drag-text">
                          <h4>Drag and drop your CSV/Excel file here</h4>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" (click)="clear()" class="btn btn-default">Clear
        </button>
        <button type="submit" class="btn btn-primary" form="bulkUploadFormID" [disabled]="!bulkUploadForm.valid">Upload
        </button>
      </div>

    </div>
  </div>
</div>
