<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' "
  #scrollToTop [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow ">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <li><a routerLink="/iol/admin/fuel">Fuel</a></li>
  </ol>
</div>


<div
  [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "
  style="padding-bottom:200px" [hidden]="!isAuthorized">

  <div class="panel-heading font-weight-600 margin-bottom-0">
  </div>

  <div class="panel-body padding-0">
    <div class="tab-content">
      <div class="tab-pane active" id="Summary">
        <div class=" margin-bottom-0">
          <div class=" padding-15">
            <div class="row">

              <div class="col-lg-4">
                <div class="panel panel-default card shadow light" style="height: 580px;">
                  <div class="col-lg-10" style="padding:0px; margin-top: 10px; margin-bottom: 15px; margin-left: 20px;">
                    <a></a>
                    <button type="button" *ngIf="add_btn == 0 && loggedInUser.read_only != true"
                      class="btn btn-lg btn-primary btn-block btncolor" (click)="clearForm()" data-target="#editpop1"
                      data-toggle="modal" style="font-size: 14px;border-radius: 20px;"> <i
                        class="ri-add-circle-fill"></i> New
                    </button>
                  </div>

                  <div class="col-lg-12" style="margin-top: 5px; margin-bottom: 5px;">
                    <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">
                      <div class="form-group margin-bottom-10">
                        <fieldset class="form-fieldset">
                          <legend>Search</legend>

                          <div class="form-group margin-bottom-10">
                            <div class="input-search">
                              <i class="input-search-icon ri-search-line"></i>
                              <input type="text" class="form-control" formControlName="search" [(ngModel)]="inputValue"
                                name="search" placeholder="Search...">
                              <button type="button" class="input-search-close icon " data-toggle="popover"
                                data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                                data-html="true" id="help2"><i class="ri-question-line"
                                  pTooltip="Search by Driver name"></i></button>
                              <div id="popover-content-help2" class="hide">
                                Some help information goes here
                              </div>
                            </div>
                          </div>

                          <div class="form-group margin-bottom-0 text-center">
                            <button href="" type="submit" (click)='updateFilter(inputValue)'
                              class="btn btn-success btn-round btn-block1"> <i class=" ri-search-line "></i>
                              Search</button>
                            <button (click)="onClearSearch()" href=" " class="btn btn-default btn-round "> <i
                                class="ri-refresh-line "></i>
                              Clear
                            </button>
                          </div>
                        </fieldset>
                      </div>

                      <hr>

                      <!-- Download Buttons start-->
                      <div class="form-group margin-bottom-0">
                        <label class="font-size-14 font-weight-600 ">Export:</label>
                        <div class="btn-group btn-group-justified">
                          <div class="btn-group" role="group">
                            <a (click)="downloadXLS(downloadableLink)">
                              <button type="button" class="btn btn-outline btn-default"> <img
                                  src="../../../assets/images/icon-xls.png" height="50">
                                <div class="font-size-12">
                                  <!-- [href]="downloadableLink" -->
                                  <a  class="enabled">
                                    Download XLS </a>
                                </div>
                              </button>
                            </a>
                          </div>
                          <div class="btn-group" role="group">
                            <a (click)="downloadPDF(downloadableLink1)">
                              <button type="button" class="btn btn-outline btn-default"> <img
                                  src="../../../assets/images/icon-pdf.png" height="50">
                                <div class="font-size-12">Download PDF</div>
                              </button>
                            </a>
                          </div>

                        </div>
                      </div>
                      <!--  Download Buttons ends -->

                    </form>
                  </div>


                </div>
              </div>

              <div class="col-lg-8">
                <div class="row">
                  <div class="col-lg-12">
                    <div class="panel panel-default  padding-0  card  light"
                      style="min-height: 200px; color: aliceblue;">
                      <div class="panel-heading margin-bottom-0">
                        <h3 class="panel-title font-weight-600 bg-theme1 white1 ">Fuel List</h3>
                      </div>
                      <!-- <mat-tab-group (selectedTabChange)="activeTabFuction($event)"> -->
                      <!-- Fuel List Tab -->
                      <!-- <mat-tab label="Fuel List"> -->

                      <div class="table-responsive margin-top-20 " style="border: 1px solid #ebebeb;">
                        <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}"
                          mode="indeterminate"></p-progressBar>

                        <table matSort (matSortChange)="sortFuelList($event)"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1"
                          mat-table [dataSource]="trucks" mat-elevation-z8>
                          <ng-container matColumnDef="fuel_filled">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>FUEL FILLED (litres)</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.fuel_filled }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="location">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>LOCATION</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.location }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="device_name">
                            <th mat-header-cell *matHeaderCellDef>REG #</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.device_name }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="amount_paid">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>AMOUNT PAID (QAR)</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.amount_paid }}</td>
                          </ng-container>
                          <ng-container matColumnDef="payment_method_name">
                            <th mat-header-cell *matHeaderCellDef>PAYMENT METHOD</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.payment_method_name }}</td>
                          </ng-container>
                          <ng-container matColumnDef="driver_name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>DRIVER NAME</th>
                            <td mat-cell *matCellDef="let row">
                              {{ row.driver_name }}</td>
                          </ng-container>
                          <ng-container matColumnDef="fuel_supervisor_name">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>SUPERVISOR NAME</th>
                            <td mat-cell *matCellDef="let row">{{ row.fuel_supervisor_name }}</td>
                          </ng-container>
                          <ng-container matColumnDef="fill_up_date">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLUP DATE TIME</th>
                            <td mat-cell *matCellDef="let row">
                              {{ (row.fill_up_date | date: 'M/d/yyyy h:mm:ss a ') || 'N/A' }}</td>
                          </ng-container>
                          <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
                            <td mat-cell *matCellDef="let row">
                              <button type="button" *ngIf="loggedInUser.read_only != true"
                                class="btn btn-icon  btn-info btn-xs " data-target="#editpop1"
                                (click)="openEditModal(row)" data-toggle="modal" pTooltip="Edit">
                                <i class="icon ion-edit"></i>
                                <!-- [hidden]="disableButton(row)"  (click)="openEditModal(row)"-->
                              </button>
                              <button type="button" *ngIf="loggedInUser.read_only != true" pTooltip="Delete "
                                class="btn btn-icon  btn-danger btn-xs " data-original-title="Delete"
                                (click)="showDeleteConfirmation(row)"> <i class="icon ion-android-delete"></i>
                              </button>
                              <button type="button" pTooltip="View" tooltipPosition="top"
                                class="btn btn-icon  btn-info btn-xs" data-target="#editpop2" data-toggle="modal"
                                data-original-title="View" (click)="openEditModal2(row)">
                                <i class="icon ion-eye"></i>
                              </button>

                              <!-- (click)="showDeleteCategoryConfirmation(row.id, 'vehicle')" -->
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedFuelList"></tr>
                          <tr mat-row *matRowDef="let row; columns: displayedFuelList;"></tr>
                        </table>
                        <div *ngIf="trucks?.length === 0" class="no-records">No records found</div>
                        <mat-paginator translate="no" #fuelListPaginator [length]="totalFuelLength"
                          [hidePageSize]="true" showFirstLastButtons (page)="onPaginateFuel($event)" [pageSize]="10">
                        </mat-paginator>
                      </div>
                      <!-- </mat-tab> -->

                      <!-- Fuel Reporting Tab -->
                      <!-- <mat-tab label="Fuel Reporting">
                          <div class="row margin-top-20">
                            <app-reporting-buttons [calendarDimension]="'col-sm-9'" [selected]="'month'"
                              [type]="'trail'" [timeRange]="true" [hideBtn]="'today yesterday week month'"
                              (btnClicked)="setupReport($event)">
                            </app-reporting-buttons>
                          </div>

                          <div class="row">
                            <div class="col-lg-12">
                              <div class="table-responsive margin-top-20">
                                <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}"
                                  mode="indeterminate"></p-progressBar>

                                <table matSort (matSortChange)="sortFuelReporting($event)"
                                  class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1"
                                  mat-table [dataSource]="fuelReporting" mat-elevation-z8>
                                  <ng-container matColumnDef="fill_up_date">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLUP DATE</th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ (row.fill_up_date * 1000 | date: 'M/d/yyyy, h:mm:ss a') || 'N/A' }}
                                    </td>
                                  </ng-container>
                                  <ng-container matColumnDef="fuel_filled">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLED UP QUANTITY (LITERS)
                                    </th>
                                    <td mat-cell *matCellDef="let row">{{ row.fuel_filled || 'N/A' }}</td>
                                  </ng-container>
                                  <ng-container matColumnDef="amount_paid">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLUP AMOUNT (QAR)</th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.amount_paid || 'N/A' }}</td>
                                  </ng-container>
                                  <ng-container matColumnDef="payment_method_name">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>PAYMENT METHOD</th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.payment_method_name || 'N/A' }}</td>
                                  </ng-container>
                                  <ng-container matColumnDef="location">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLUP LOCATION</th>
                                    <td mat-cell *matCellDef="let row" style="text-align: center;">
                                      {{row.location}}
                                    </td>
                                  </ng-container>
                                  <ng-container matColumnDef="fuel_supervisor_name">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>FILLUP SUPERVISOR</th>
                                    <td mat-cell *matCellDef="let row">
                                      {{ row.fuel_supervisor_name  || 'N/A' }}</td>
                                  </ng-container>

                                  <tr mat-header-row *matHeaderRowDef="displayedFuelReporting"></tr>
                                  <tr mat-row *matRowDef="let row; columns: displayedFuelReporting;"></tr>
                                </table>
                                <mat-paginator translate="no" #fuelReportingPaginator [length]="totalFuelReportingLength"
                                  [hidePageSize]="true" showFirstLastButtons (page)="onPaginateFuelReporting($event)"
                                  [pageSize]="10">
                                </mat-paginator>
                              </div>
                            </div>
                          </div>
                        </mat-tab> -->

                      <!-- </mat-tab-group> -->
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div #fuelListModal class="modal fade  modal-success text-left" id="editpop1" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center  modal-lg">
    <div class="modal-content">
      <div class="modal-header" [ngStyle]="theme">
        <button type="button" class="close" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title">{{formTitle}}</h4>
        <!-- {{inactiveRecord? 'View Vehicle' : formTitle}} -->
      </div>
      <div class="modal-body">
        <div class="">
          <div class="row">
            <div class="col-lg-12">
              <form novalidate [formGroup]="truckForm" id="truckFormID" (ngSubmit)="onSubmit(truckForm.value)">
                <fieldset [disabled]="inactiveRecord">
                  <div class="row">
                    <div class="col-lg-3">
                      <div class="form-group">
                        <label class="control-label form-label">Vehicle Reg #<span class="text-danger2">*</span>
                        </label>
                        <p-dropdown [(ngModel)]="selectedDevice" *ngIf="!inactiveRecord" [options]="customerDevices"
                          formControlName="device" name="selectedDevice" styleClass="prime-dropdown"
                          placeholder="Select Reg #">
                        </p-dropdown>
                        <input *ngIf="inactiveRecord" class="form-control" formControlName="device" />

                        <span class="error-message" *ngIf="truckForm.get('device').getError('required') && submitted">
                          Please provide vehicle reg #
                        </span>
                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group">
                        <label class="control-label form-label">Fuel Filled<span class="text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" min="0" formControlName="fuel_filled" type="number" />

                          <span class="error-message"
                            *ngIf="truckForm.get('fuel_filled').getError('required') && submitted">
                            Please enter a valid Fuel Filled value
                          </span>

                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group">
                        <label class="control-label form-label">Location<span class="text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="location" />

                          <span class="error-message"
                            *ngIf="truckForm.get('location').getError('required') && submitted">
                            Please provide location
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group   ">
                        <label class="control-label form-label">Amount Paid (QAR)<span
                            class="text-danger2">*</span></label>
                        <input class="form-control" formControlName="amount_paid" type="number" />

                        <span class="error-message"
                          *ngIf="truckForm.get('amount_paid').getError('isNumbers') && submitted">Enter
                          valid amount</span>

                        <span class="error-message"
                          *ngIf="truckForm.get('amount_paid').getError('required') && submitted">
                          Please enter a valid amount
                        </span>

                      </div>
                    </div>
                    <div class="col-lg-3">
                      <div class="form-group">
                        <label class="control-label form-label">Payment Method<span
                            class="text-danger2">*</span></label>
                        <p-dropdown [(ngModel)]="selectedPurchase" *ngIf="!inactiveRecord" [options]="purchaseTypes"
                          formControlName="payment_method" name="selectedType" styleClass="prime-dropdown"
                          placeholder="Select Payment Method">
                        </p-dropdown>
                        <input *ngIf="inactiveRecord" class="form-control" formControlName="payment_method" />

                        <span class="error-message"
                          *ngIf="truckForm.get('payment_method').getError('required') && submitted">
                          Please provide payment method
                        </span>

                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group">
                        <label class="control-label form-label">Driver Name<span class="text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="driver_name" maxLength="25" />
                          <span class="error-message"
                            *ngIf="truckForm.get('driver_name').getError('required') && submitted">
                            Please provide driver name
                          </span>
                          <span class="error-message"
                            *ngIf="truckForm.get('driver_name').getError('isAlphabetsAndSpace') && submitted">
                            Enter Alphabets only.
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group">
                        <label class="control-label form-label">Fuel Supervisor Name<span
                            class="text-danger2">*</span></label>
                        <div class="input-icon">
                          <input class="form-control" formControlName="fuel_supervisor_name" maxLength="25" />
                          <span class="error-message"
                            *ngIf="truckForm.get('fuel_supervisor_name').getError('required') && submitted">
                            Please provide supervisor name
                          </span>
                          <span class="error-message"
                            *ngIf="truckForm.get('fuel_supervisor_name').getError('isAlphabetsAndSpace') && submitted">
                            Enter Alphabets only.
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-sm-6">
                      <div class="form-group">
                        <label class="control-label form-label">Fillup Date<span class="text-danger2">*</span></label>
                        <!-- <div class="input-icon"> -->
                        <!-- <p-calendar id="clendertopfix" placeholder="Select Start Date" [styleClass]="'prime-datetime'"
                          hideOnDateTimeSelect="true" [yearRange]="'2000:'+(currentDate.getFullYear())"
                          [showButtonBar]="true" [yearNavigator]="true" [monthNavigator]="true"
                          formControlName="fill_up_date" [maxDate]="maxDate" [showTime]="true">
                        </p-calendar> -->

                        <p-calendar id="clendertopfix" placeholder="Select Start Date" [styleClass]="'prime-datetime'"
                          formControlName="fill_up_date" [maxDate]="currentDate" showTime="true" hourFormat="24"
                          [yearRange]="'2000:'+(currentDate.getFullYear())"></p-calendar>

                        <span class="error-message" style="margin-left: -194px;margin-top:35px"
                          *ngIf="truckForm.get('fill_up_date').getError('required') && submitted">
                          Please provide fillup date
                        </span>
                        <!-- </div> -->
                      </div>
                    </div>
                  </div>
                </fieldset>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-round btn-block1" #closeForm
          data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-success btn-round btn-block1" form="truckFormID">{{btnText}}</button>
        <!-- [disabled]="!truckForm.valid || btnLoading || inactiveRecord" -->
      </div>
    </div>
  </div>
</div>

<div class="modal fade  modal-success text-left" data-backdrop="static" id="editpop2" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-center" [ngClass]="'modal-lg'">
    <div class="modal-content">
      <div [ngStyle]="theme" class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
          <span>x</span>
        </button>
        <h4 class="modal-title title-color" title-color>Fuel Receipt</h4>
      </div>
      <div class="modal-body padding-bottom-20">
        <div class="">
          <div style="margin-top: -20px;" class="row1">

            <div class=" margin-top-20 margin-bottom-20 padding-20 bg-blue-00 shadow1 card1"
              style="border: 1px solid #eee; background-color: #f9f9f9;">


              <div class="row">

                <div class="col-md-12">

                  <div class="media">
                    <div class="">
                      <figure class="">
                        <img src={{image}} class="img-bordered" style="height: 350px">
                      </figure>
                    </div>

                  </div>
                </div>



              </div>
            </div>


          </div>
        </div>
      </div>
    </div>
  </div>
</div>