<app-unauthorized-page (isAuthorized)="isAuthorizedUser($event)" *ngIf="!isAuthorized"></app-unauthorized-page>
<!-- <app-breadcrumbs [items]="items" [home]="home" #scrollToTop [hidden]="!isAuthorized"></app-breadcrumbs> -->

<div [className]="sidebarCheck ? 'half-open-breadcrum breadcrumb-box' : 'full-open-breadcrum breadcrumb-box' "
  [hidden]="!isAuthorized">
  <ol class="breadcrumb breadcrumb-arrow ">
    <li><a class="icon ion-ios-home" routerLink="/iol"> Dashboard </a> </li>
    <li><a> Maintenance</a></li>
  </ol>
</div>

<div
  [className]="sidebarCheck ? 'half-open-sidebar page-content  container-fluid' : 'full-open-sidebar page-content  container-fluid' "
  [hidden]="!isAuthorized">
  <div class="row">
    <div [ngClass]="{'col-md-2': cardsArray.length === 4, 'col-lg-2': cardsArray.length === 3}"
      *ngFor="let card of cardsArray; let i = index" [attr.data-index]="i">
      <app-stats-icon-card [icon]="card.icon" [bgStyle]="card.color" [totalCount]="card.data.total_count"
        [iconHeight]="35" [label]="card.name" [footerArr]="card.data.footer" [data]="card"
        [footerStyle]="card.footer_color">
      </app-stats-icon-card>
    </div>

    <div [ngClass]="{'col-md-4': cardsArray?.length === 4,'col-md-6': cardsArray?.length === 3}">
      <div
        class="flex-card flex-action-widget padding-15 bg-blue-800 text-center relative shadow white margin-bottom-30">
        <app-dashboard-widget [widgetData]="widgetData" (selectedWidget)="getSelectedWidgetOption($event)"
          (exportToCSV)="ExportMaintenanceListAsCSV()">
        </app-dashboard-widget>
      </div>
    </div>
  </div>

  <div class="row" *ngIf="graphsArray && graphsArray?.length > 0">
    <div class="col-lg-8">
      <div style="height: 400px;" class="panel panel-default card light shadow margin-bottom-30">
        <div class="panel-heading">
          <h3 class="panel-title font-weight-600"
            *ngIf="vehicleMaintenanceGraph?.is_selected && vehicleMaintenanceGraph?.name == 'Vehicle Maintenance Graph'">
            Vehicle Maintenance
            <span><small><strong>(LAST 30 DAYS)</strong></small></span>
          </h3>
        </div>

        <div class="panel-body small-ui-dropdown">
          <div class="chartbox" *ngIf="vehicleMaintenance?.length>0 && vehicleMaintenanceGraph?.is_selected">
            <div id="chartdiv" style="width: auto; height: 350px"></div>
          </div>
          <div *ngIf="!vehicleMaintenanceGraph?.is_selected || vehicleMaintenance?.length==0"
            style="display: flex; align-items: center;justify-content: center;flex-direction: column;">
            <img style="opacity:0.3; margin-top: 95px!important;" src="assets/images/no-graph.png" alt=""
              width="80px"><br>
            <span>No record found!</span>
          </div>
        </div>
      </div>
    </div>


    <div class="col-lg-4">
      <div style="height: 400px;" class="panel panel-default card light shadow margin-bottom-30">
        <div class="panel-heading">
          <h3 class="panel-title font-weight-600"
            *ngIf="MaintenanceGraph.is_selected && MaintenanceGraph.name == 'Maintenance status '">
            {{MaintenanceGraph.name}}
          </h3>
        </div>

        <div class="panel-body small-ui-dropdown">
          <div class="chartbox" *ngIf="MaintenanceGraph.is_selected && MaintenanceGraph.name == 'Maintenance status '">
            <app-radial-chart style="overflow: scroll !important;" [chartOptions]="MaintenanceGraph?.data"
              [graphHeight]="graphHeight" [chartFilter]="MaintenanceGraph.ui_filter.data"
              [graphId]="MaintenanceGraph.id" [graphType]="MaintenanceGraph.type"
              [graphUseCaseId]="MaintenanceGraph.use_case_id" (selectedFilters)="getSelectedGraphData($event)">
            </app-radial-chart>
          </div>
          <div *ngIf="!MaintenanceGraph.is_selected"
            style="display: flex; align-items: center;justify-content: center;flex-direction: column;">
            <img style="opacity:0.3; margin-top: 95px!important;" src="assets/images/no-graph.png" alt=""
              width="80px"><br>
            <span>No record found!</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-lg-4">
      <div class="panel panel-default  padding-0 round card shadow light " style="min-height: 200px;">
        <div class="panel-heading margin-bottom-0">
          <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">Choose Parameters</h3>
          <div class="panel-actions">
            <a></a>
          </div>
        </div>
        <div class="panel-body padding-0">
          <div class="tab-content">
            <div class="tab-pane active" id="Summary">
              <div class="panel panel-default margin-bottom-0 ">
                <div class="panel-body padding-15 " style="min-height: 580px;">

                  <form [formGroup]="searchForm" (ngSubmit)="onSearch(searchForm.value)">

                    <div class="form-group margin-bottom-10">
                      <fieldset class="form-fieldset">
                        <legend>Filter</legend>

                        <div class="form-group margin-bottom-10">
                          <p-dropdown [options]="fleetListing" formControlName="searchFleet" name="searchFleet"
                            (onChange)="selectFleetDropDownChange($event)" styleClass="prime-dropdown"
                            placeholder="Select Vehicle Group">
                          </p-dropdown>
                        </div>
                        <div class="form-group margin-bottom-10">
                          <p-dropdown [options]="vehicleListing" formControlName="searchVehicle" name="searchVehicle"
                            (onChange)="selectVehicleDropDownChange($event)" styleClass="prime-dropdown"
                            placeholder="Select Vehicle">
                          </p-dropdown>
                        </div>
                        <div class="form-group margin-bottom-10">
                          <p-dropdown [options]="serviceTypeList" formControlName="searchServiceType"
                            name="searchServiceType" (onChange)="selectFilterServiceType($event)"
                            styleClass="prime-dropdown" placeholder="Select Service Type">
                          </p-dropdown>
                        </div>

                      </fieldset>
                    </div>
                    <div class="form-group margin-bottom-10">
                      <fieldset class="form-fieldset">
                        <legend>Search</legend>
                        <div class="form-group margin-bottom-10">
                          <div class="input-search">
                            <input type="text" class="form-control" formControlName="search" placeholder="Search...">

                            <button type="button" class="input-search-close icon " data-toggle="popover"
                              data-original-title="" data-trigger="hover" data-container="body" data-placement="top"
                              data-html="true" id="help2">
                              <i class="ri-question-line" pTooltip="Search"></i>
                            </button>

                            <div id="popover-content-help2" class="hide">
                              Some help information goes here
                            </div>
                          </div>
                        </div>

                        <div class="form-group margin-bottom-0 text-center">
                          <button href="" type="submit" class="btn btn-success btn-round btn-block1">
                            <i class=" ri-search-line "></i>
                            Search
                          </button>
                          <button (click)="onClearSearch()" class="btn btn-default btn-round ">
                            <i class="ri-refresh-line "></i>
                            Clear
                          </button>
                        </div>

                      </fieldset>
                    </div>

                    <hr>
                    <!-- Download Buttons start-->
                    <div class="form-group margin-bottom-0">
                      <label class="font-size-14 font-weight-600 ">Export:</label>
                      <div class="btn-group btn-group-justified">
                        <div class="btn-group" role="group">
                          <!-- [href]="downloadableLink" -->
                          <a (click)="downloadXLS(downloadableLink)">
                            <button type="button" class="btn btn-outline btn-default"> <img
                                src="../../../assets/images/icon-xls.png" height="50">
                              <div class="font-size-12">
                                <!-- [href]="downloadableLink" -->
                                <a class="enabled">Download XLS </a>
                              </div>
                            </button>
                          </a>
                        </div>
                        <div class="btn-group" role="group">
                          <!-- [href]="downloadableLink1" -->
                          <a (click)="downloadPDF(downloadableLink1)">
                            <button type="button" class="btn btn-outline btn-default"> <img
                                src="../../../assets/images/icon-pdf.png" height="50">
                              <div class="font-size-12">Download PDF</div>
                            </button>
                          </a>
                        </div>

                      </div>
                    </div>
                    <!-- Download Buttons ends-->

                  </form>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="panel panel-default  padding-0 round card shadow light " style="min-height: 200px;">
        <div class="panel-heading margin-bottom-0">
          <h3 class="panel-title font-weight-600 bg-teal-8001 white1 ">List</h3>
          <div class="panel-actions">
            <a></a>
          </div>
        </div>
        <div class="panel-body padding-0">
          <div class="tab-content">
            <div class="tab-pane active" id="Summary">
              <div class="panel panel-default margin-bottom-0 ">
                <div class="panel-body padding-15 " style="min-height: 580px;">
                  <div class="page-main">
                    <div class="">
                      <div class="row margin-bottom-20">
                        <app-reporting-buttons [calendarDimension]="'col-sm-9'" [selected]="'month'" [type]="'trail'"
                          [timeRange]="true" [hideBtn]="'today yesterday week month'"
                          (btnClicked)="setupReport($event)">
                        </app-reporting-buttons>
                      </div>

                      <div class="row">
                        <div class="col-lg-12">
                          <div class="table-responsive " style="    border: 1px solid #ebebeb;">
                            <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '3px'}"
                              mode="indeterminate">
                            </p-progressBar>

                            <table matSort (matSortChange)="sortData($event)"
                              class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1"
                              mat-table [dataSource]="dataSource" mat-elevation-z8>
                              <ng-container matColumnDef="id">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                                <td mat-cell *matCellDef="let row">
                                  {{row.device_id ||'N/A'}}
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="device_id__name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>VEHICLE</th>
                                <td mat-cell *matCellDef="let row">
                                  <div class="media-body pointer" [routerLink]="gotoService.gotoTruck(row.device_id)">
                                    <a class="font-weight-600">{{row.vehicle_name}}</a>
                                  </div>
                                  {{row.vehicle_name}}
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="driver_id__name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>DRIVER</th>
                                <td mat-cell *matCellDef="let row">
                                  {{ row.driver_name || 'N/A' }}
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="technician_name">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>TECHNICIAN</th>
                                <td mat-cell *matCellDef="let row">
                                  {{ (row.technician_name) || '-' }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="maintenance_type_id__label">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>SERVICE TYPE
                                </th>
                                <td mat-cell *matCellDef="let row">
                                  {{ (row.maintenance_type) ||
                                  'N/A'}}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="maintenance_status_id__label">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>MAINTENANCE
                                  STATUS</th>
                                <td mat-cell *matCellDef="let row">
                                  {{ (row.maintenance_status) ||
                                  'N/A' }}
                                </td>
                              </ng-container>

                              <ng-container matColumnDef="start_datetime">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>START DATE</th>
                                <td mat-cell *matCellDef="let row">
                                  {{ (row.start_datetime |
                                  date:'M/d/yyyy, hh:mm:ss a') || '-'}}
                                </td>
                              </ng-container>
                              <ng-container matColumnDef="end_datetime">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>END DATE</th>
                                <td mat-cell *matCellDef="let row">
                                  {{ (row.end_datetime |
                                  date:'M/d/yyyy, hh:mm:ss a' ) || '-'}}
                                </td>
                              </ng-container>

                              <tr mat-header-row *matHeaderRowDef="displayedColumns">
                              </tr>
                              <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                              </tr>
                            </table>
                            <div *ngIf="dataSource?.length === 0" class="no-records">No records found</div>
                            <mat-paginator translate="no" #paginator [length]="totalLength" [hidePageSize]="true"
                              showFirstLastButtons [pageSize]="10" (page)="onPaginateChange($event)">
                            </mat-paginator>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>