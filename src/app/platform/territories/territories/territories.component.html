<app-breadcrumbs [items]="items" [home]="home" #scrollToTop></app-breadcrumbs>
<div class="page-content   container-fluid  full-open-sidebar"   >
  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default  padding-0 round card shadow light" style="min-height: 200px;">
        <div class="panel-heading font-weight-600 margin-bottom-0"></div>
        <div class="panel-body padding-0">
          <div class="tab-content">
            <div class="tab-pane active" id="Summary">
              <div class="panel panel-default margin-bottom-0 ">
                <div class="panel-body padding-15 ">
                  <div class="row">
                    <div class="col-lg-4">
                      <div>
                        <input type="text" (keyup)='keyUp.next($event)' [(ngModel)]="searchParameters.search_key" name="search-key"
                          class="form-control input-sm" placeholder="Search" style="height:36px;">
                      </div>

                      <div style="margin-top: 15px;margin-bottom: 15px;">
                        <select (change)="getData($event)" [(ngModel)]="optionSelection" name="selection"
                          class="form-control select2">
                          <option>Routes</option>
                          <option selected>Zones</option>
                        </select>
                      </div>

                      <div class="checkbox">
                        <label><input name='is-poi-checkbox' [attr.disabled]="!poiClicked ? null : true" (change)="poiChanged()" [(ngModel)]="searchParameters.is_poi" type="checkbox">Point
                          of Interest</label>
                      </div>

                      <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '5px'}"
                        mode="indeterminate">
                      </p-progressBar>
                      <div class="table-responsive" *ngIf="isZoneSelected">
                        <table mat-table [dataSource]="zoneList"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1">

                          <!-- ID Column -->
                          <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Name </th>
                            <td mat-cell *matCellDef="let row"> {{row.name}} </td>
                          </ng-container>

                          <!-- Progress Column -->
                          <ng-container matColumnDef="assigned_vehicles_count">
                            <th mat-header-cell *matHeaderCellDef> Total Vehicles </th>
                            <td mat-cell *matCellDef="let row"> {{row.assigned_vehicles_count}} </td>
                          </ng-container>

                          <!-- Status Column -->
                          <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef> Status </th>
                            <td mat-cell *matCellDef="let row"><span class="label"
                              [ngClass]="(row.status === EntityStatusEnum.Active)? 'label-success': 'label-danger'">{{(row.status === EntityStatusEnum.Active)? 'Active' : 'Inactive'}}</span>
                          </td>
                          </ng-container>


                          <!-- <ng-container matColumnDef="detail">
                            <th mat-header-cell *matHeaderCellDef> Detail </th>
                            <td mat-cell *matCellDef="let row">
                              <mat-icon>info</mat-icon>
                            </td>
                          </ng-container> -->

                          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                          <tr mat-row  [ngClass] = "{'active': row.id === zoneId}" class="select" *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)"></tr>

                        </table>
                        <app-spin-loading [appLoader]="appLoader" [size]="'sm'"></app-spin-loading>
                      </div>

                      <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '5px'}"
                        mode="indeterminate">
                      </p-progressBar>
                      <div class="table-responsive" *ngIf="!isZoneSelected">
                        <table mat-table [dataSource]="routeList"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1">

                          <!-- ID Column -->
                          <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Name </th>
                            <td mat-cell *matCellDef="let row"> {{row.name || 'N/A'}} </td>
                          </ng-container>

                          <!-- Progress Column -->
                          <ng-container matColumnDef="assigned_vehicles_count">
                            <th mat-header-cell *matHeaderCellDef> Total Vehicles </th>
                            <td mat-cell *matCellDef="let row"> {{row.assigned_vehicles_count}} </td>
                          </ng-container>

                          <!-- Status Column -->
                          <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef> Status </th>
                            <td mat-cell *matCellDef="let row"> {{(row.status === 1)? 'Active': 'Inactive' }} </td>
                          </ng-container>


                          <!-- <ng-container matColumnDef="detail">
                            <th mat-header-cell *matHeaderCellDef> Detail </th>
                            <td mat-cell *matCellDef="let row">
                              <mat-icon>info</mat-icon>
                            </td>
                          </ng-container> -->

                          <tr mat-header-row *matHeaderRowDef="displayedColumnsForRoutes"></tr>
                          <tr mat-row [ngClass] = "{'active': row.id === routeId}" class="select" *matRowDef="let row; columns: displayedColumnsForRoutes;"
                            (click)="onRowClick(row)"></tr>

                        </table>
                        <app-spin-loading [appLoader]="appLoader" [size]="'sm'"></app-spin-loading>
                      </div>
                    </div>

                    <div class="col-lg-8">
                      <div class="panel-heading " style="background:#E60000;margin-bottom: 0px;">
                        <h3 class="panel-title font-weight-600 " style="color: white;">
                          Map
                        </h3>
                        <div class="panel-actions">
                          <a class="panel-action "></a>
                        </div>
                      </div>

                      <div class="map-wrapper" style="position:relative">
                        <!-- <div #gmap style="width:100%;" [ngStyle]="{'height':'590px'}"></div> -->
                        <app-google-map #map [height]="'500px'"></app-google-map>
                        <app-spin-loading [appLoader]="mapLoader"></app-spin-loading>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default  padding-0 round card shadow light " style="min-height: 200px;">
        <div class="panel-body padding-0">
          <div class="tab-content">
            <div class="tab-pane active" id="Summary">
              <div class="panel panel-default margin-bottom-0 ">
                <div class="panel-body padding-15">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="row margin-bottom-10">
                        <app-reporting-buttons [calendarDimension]="'col-sm-9'" [type]="'trail'" [timeRange]="true"
                          [hideBtn]="'today yesterday week month'" (btnClicked)="filtersStopsListing($event)">
                        </app-reporting-buttons>
                      </div>

                      <div class="table-responsive1">
                        <p-progressBar *ngIf="showIndeterminateProgress" [style]="{'height': '5px'}"
                          mode="indeterminate">
                        </p-progressBar>
                        <table mat-table [dataSource]="violationList?.data"
                          class="table margin-bottom-0 table-condensed1 table-bordered1 text-wrap theme-table1">

                          <!-- ID Column -->
                          <ng-container matColumnDef="device_name">
                            <th mat-header-cell *matHeaderCellDef> Vehicle No. </th>
                            <td mat-cell *matCellDef="let row">
                              <div style="width: 120px; float: left">
                                <div class="media-body pointer" routerLink="/iol/fleets/{{row.id}}"
                                  [queryParams]="{ usecase: useCaseId}">
                                  <a class="font-weight-600">{{ row.device_name || 'N/A' }}</a>
                                </div>
                              </div>
                            </td>
                          </ng-container>

                          <!-- Progress Column -->
                          <ng-container matColumnDef="violation_type_name">
                            <th mat-header-cell *matHeaderCellDef> Type </th>
                            <td mat-cell *matCellDef="let row"> {{row.violation_type_name}} </td>
                          </ng-container>

                          <!-- Progress Column -->
                          <ng-container matColumnDef="vehicle_out_territory">
                            <th mat-header-cell *matHeaderCellDef> Territory Status </th>
                            <td mat-cell *matCellDef="let row">
                              <span *ngIf="row.vehicle_in_territory == false && row.vehicle_out_territory == false">N/A</span>
                              <span *ngIf="row.vehicle_in_territory == true">
                                <mat-chip color="green">In Zone</mat-chip>
                              </span>
                              <span *ngIf="row.vehicle_out_territory == true">
                                <mat-chip color="warm">Out of Zone</mat-chip>
                              </span>
                            </td>
                          </ng-container>

                          <!-- Status Column -->
                          <ng-container matColumnDef="territory">
                            <th mat-header-cell *matHeaderCellDef> Territory Name </th>
                            <td mat-cell *matCellDef="let row"> {{row.territory || 'N/A'}} </td>
                          </ng-container>

                          <!-- Status Column -->
                          <ng-container matColumnDef="location">
                            <th mat-header-cell *matHeaderCellDef> Location </th>
                            <td mat-cell *matCellDef="let row"> {{row.location || 'N/A'}} </td>
                          </ng-container>

                          <!-- Status Column -->
                          <ng-container matColumnDef="created_at">
                            <th mat-header-cell *matHeaderCellDef> Violation Date/Time </th>
                            <td mat-cell *matCellDef="let row"> {{row.created_at | date: 'M/d/yyyy, h:mm:ss a'}} </td>
                          </ng-container>

                          <ng-container matColumnDef="detail">
                            <th mat-header-cell *matHeaderCellDef> Detail </th>
                            <td mat-cell *matCellDef="let row">
                              <div (click)="openTerritoryViolations(row)">
                                <i class="icon-location pointer" type="button" data-toggle="modal" data-target="#myModal2"
                                ><img src="../assets/images/iol/icon-location.png" alt="img" height="20"></i>
                              </div>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedColumnsForTerritoryReporting"></tr>
                          <tr mat-row *matRowDef="let row; columns: displayedColumnsForTerritoryReporting;"></tr>

                        </table>
                        <mat-paginator translate="no" #paginatorViolations [length]="violationList?.count" [hidePageSize]="true"
                          showFirstLastButtons (page)="onPaginate($event)" [pageSize]="10">
                        </mat-paginator>
                        <app-spin-loading [appLoader]="appLoader" [size]="'sm'"></app-spin-loading>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="track-map inline-block">
    <div class="modal right fade" id="myModal2" tabindex="-1">
      <div style="margin-top: 0; margin-right: 0" class="modal-dialog modal-sidebar" role="document">
        <button type="button" class="close" data-dismiss="modal">
            <span>×</span>
        </button>
        <div class="mapbox margin-bottom-0">
          <app-google-map #modalmap [height]="'98vh'"></app-google-map>
        </div>
      </div>
    </div>
  </div>
</div>
